@model Inspinia_MVC5.Registro_Evento


@{
    /**/

    ViewBag.Title = "Nueva";
}

<style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    /*span.select2-container {
        z-index: 10050 !important
    }*/


    #mapCanvas {
        height: 100%;
        margin: 50px;
        padding: 200px;
    }
    /* Optional: Makes the sample page fill the window. */
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
</style>


<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2>Nuevo</h2>
        <ol class="breadcrumb">

            <li class="active">

            </li>
        </ol>
    </div>
    <div class="col-sm-8">
        <div class="title-action">
            @Html.ActionLink("Volver a la lista", "Index", null, new { @class = "btn btn-primary" })
        </div>
    </div>
</div>


<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Nuevo Registro de Evento</h5>
                </div>
                <div class="ibox-content">

                    @using (Html.BeginForm())
                    {
                        @Html.AntiForgeryToken()


                        <div class="form-horizontal" id="campoevento">
                            @Html.ValidationSummary(true)

                            <div class="form-group">
                                Regional
                                @*@Html.LabelFor(model => model.RegionalId, "RegionalId", new { @class = "control-label col-md-2" })*@
                                <div class="col-md-12">
                                    <select name="RegionalId" id="RegionalId" data-id="" class="form-control"></select>
                                    @*@Html.DropDownList("RegionalId", String.Empty)
                                        @Html.ValidationMessageFor(model => model.RegionalId)*@
                                </div>
                            </div>

                            <div class="form-group">


                                Comandancia
                                @*@Html.LabelFor(model => model.ComandanciaId, "ComandanciaId", new { @class = "control-label col-md-2" })*@
                                <div class="col-md-12">
                                    <select name="ComandanciaId" id="ComandanciaId" class="form-control"></select>
                                    @*@Html.DropDownList("ComandanciaId", String.Empty)
                                        @Html.ValidationMessageFor(model => model.ComandanciaId)*@
                                </div>
                            </div>

                            <div class="form-group">
                                Zona
                                @*@Html.LabelFor(model => model.ZonaId, "ZonaId", new { @class = "control-label col-md-2" })*@
                                <div class="col-md-12">
                                    <select name="ZonaId" id="ZonaId" class="form-control"></select>
                                    @*@Html.DropDownList("ZonaId", String.Empty)
                                        @Html.ValidationMessageFor(model => model.ZonaId)*@
                                </div>
                            </div>

                            <div class="form-group">
                                Municipio
                                @*@Html.LabelFor(model => model.MunicipioId, "MunicipioId", new { @class = "control-label col-md-2" })*@
                                <div class="col-md-12">
                                    <select name="MunicipioId" id="MunicipioId" class="form-control"></select>
                                    @*@Html.DropDownList("MunicipioId", String.Empty)
                                        @Html.ValidationMessageFor(model => model.MunicipioId)*@
                                </div>
                            </div>

                            @*<div class="form-group">
                                    @Html.LabelFor(model => model.UsuarioId, "UsuarioId", new { @class = "control-label col-md-2" })
                                    <div class="col-md-12">
                                        @Html.DropDownList("UsuarioId", String.Empty)
                                        @Html.ValidationMessageFor(model => model.UsuarioId)
                                    </div>
                                </div>*@

                            <div class="form-group">
                                @Html.Label("Geolocalizacion")

                                <div class="col-md-12" id="formulario">
                                    <label for="direccion"></label>
                                    <input class="text-box single-line" name="Direccion" type="text" id="direccion1" size="40">
                                    <input type="button" value="Buscar Direccion" onclick="codeAddress()">
                                    @Html.Label("Longitud")
                                    <input type="text" name="GeogCol1" id="txtlongitud" />
                                    @Html.Label("Latitud")
                                    <input type="text" name="GeogCol2" id="txtlatitud" />
                                    <input type="button" value="Buscar" onclick="codeLatLon()">
                                </div>
                            </div>
                            <div class="form-group">

                                <div id="mapCanvas"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 col-form-label">Implicados</label>

                                <div class="col-sm-10">
                                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg">Agregar</button>


                                </div>
                                <div class="col-sm-10">
                                    <table class="table dataTable" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th>Oficios</th>
                                                <th>Status</th>
                                                <th>Nombre</th>
                                                <th>Apellido</th>
                                                <th>Sexo</th>
                                                <th>Nacionalidad</th>
                                                <th>Edad</th>
                                                <th>Condicion</th>
                                            </tr>
                                        </thead>
                                        <tbody id="t_tbody"></tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- Large modal -->

                            <div class="modal fade bd-example-modal-lg" id="modal_implicados" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Implicados</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">

                                            <div class="dropdown-sin-1">
                                                <label class="form-label">Oficios</label>
                                                <select id="txt_profesion" ActiveStyle=".dropdown-sin-1" class="form-control"></select><br />
                                            </div>

                                            <div class="dropdown-sin-2">
                                                <label class="col-sm-2 col-form-label">Status</label>
                                                <select id="txt_rango" ActiveStyle=".dropdown-sin-2" class="form-control"></select><br />
                                            </div>

                                            <br />
                                            <input type="text" id="txt_nombre" placeholder="Nombre" value="" class="form-control m-b">
                                            <input type="text" id="txt_apellido" placeholder="Apellido" class="form-control m-b">
                                            <input type="text" id="txt_sexo" placeholder="Sexo  'M' o 'F'" class="form-control m-b">

                                            <div class="dropdown-sin-3">
                                                <label class="col-sm-2 col-form-label">Nacionalidad</label>
                                                <select id="txt_nacionalidad" ActiveStyle=".dropdown-sin-3" class="form-control chosen-select"></select><br />
                                            </div>
                                            <br />
                                                <input type="text" id="txt_edad" placeholder="Edad" class="form-control m-b">


                                                <label class="col-sm-2 col-form-label">Condicion</label>
                                                <select id="CondicionId" class="form-control"></select>
                        

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                <button type="button" class="btn btn-primary" id="btn_agregar_lista">Agregar</button>
                                            </div>
                                        </div>
                                </div>
                            </div>

                            <div class="form-group">
                                Tipo involucrado
                                @*@Html.LabelFor(model => model.Tipo_InvolucradoId, "Tipo_InvolucradoId", new { @class = "control-label col-md-2" })*@
                                <div class="col-md-12">
                                    <select name="Tipo_InvolucradoId" id="Tipo_InvolucradoId" class="form-control"></select>
                                    @*@Html.DropDownList("Tipo_InvolucradoId", (IEnumerable<SelectListItem>)ViewBag.Tipo_InvolucradoId, new { @class = "form-control" })
                                    @Html.ValidationMessageFor(model => model.Tipo_InvolucradoId)*@
                                </div>
                            </div>



                            <div class="form-group">
                                Fecha de reporte
                                @*@Html.LabelFor(model => model.FechaReporte, new { @class = "control-label col-md-2" })*@
                                <div class="col-md-12">
                                    <input type="date" name="FechaReporte" id="FechaReporte" data-date-format="dd/mm/yyyy" class="form-control" />
                                    @Html.ValidationMessageFor(model => model.FechaReporte)
                                </div>
                            </div>


                            <div class="form-group">
                                <label for="chkb_fiscalizado">
                                    <input type="checkbox" name="Fiscalizado" id="chkb_fiscalizado" value="True" /> ¿Está fiscalizado?
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="chkb_retenido">
                                    <input type="checkbox" name="Retenido" id="chkb_retenido" value="True" /> ¿Está retenido?
                                </label>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.Comentario, new { @class = "control-label col-md-2" })
                                <div class="col-md-12">
                                    <textarea class="form-control" name="Comentario" id="Comentario"></textarea>
                                    @Html.ValidationMessageFor(model => model.Comentario)
                                </div>
                            </div>


                            <div class="form-group">
                                <div class="col-md-offset-2 col-md-12">
                                    @*<input type="submit" value="Hecho" class="btn btn-primary" />*@

                                    <input type="button" value="evento" id="btn_evento" class="btn btn-primary" />
                                    @*<input type="button" value="Crear" id="btn_crear" class="btn btn-secondary" />*@

                                    @Html.ActionLink("Cancelar", "Index", null, new { @class = "btn btn-white" })
                                </div>
                            </div>


                        </div>
                    }

                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {

    @*<link href="~/Content/select2.min.css" rel="stylesheet" />
        <script src="~/Scripts/plugins/select2/select2.full.min.js"></script>*@

    <link href="~/Content/plugins/Jquerydd/jquery.dropdown.css" rel="stylesheet" />
    <script src="~/Content/plugins/Jquerydd/jquery.dropdown.js"></script>

    <link href="~/Content/plugins/Ddsearch/selectstyle.css" rel="stylesheet" />
    <script src="~/Content/plugins/Ddsearch/selectstyle.js"></script>

    <script>
        $(document).ready(function () {

            load_combo("/Registro_Evento/GetRegionales", "#RegionalId", "Seleccione");
            load_combo("/Registro_Evento/GetComandancia", "#ComandanciaId", "Seleccione");
            load_combo("/Registro_Evento/GetZona", "#ZonaId", "Seleccione");
            load_combo("/Registro_Evento/GetMunicipios", "#MunicipioId", "Seleccione");
            load_combo("/Registro_Evento/GetTipoInvolucrado", "#Tipo_InvolucradoId", "Seleccione");


            $('#btn_evento').click(function (e) {

                var Evento = {
                    RegionalId: $('#RegionalId').val(),
                    ComandanciaId: $('#ComandanciaId').val(),
                    ZonaId: $('#ZonaId').val(),
                    MunicipioId: $('#MunicipioId').val(),
                    Direccion: $('#direccion1').val(),
                    GeogCol1: $('#txtlongitud').val(),
                    GeogCol2: $('#txtlatitud').val(),
                    Tipo_InvolucradoId: $('#Tipo_InvolucradoId').val(),
                    FechaReporte: $('#FechaReporte').val(),
                    Fiscalizado: $('#chkb_fiscalizado').val(),
                    Retenido: $('#chkb_retenido').val(),
                    Comentario: $('#Comentario').val()
                };

                var implicados = new Array();

                $('#t_tbody tr').each(function () {

                    var row = $(this);
                    var implicado = {};
                    implicado.Profesion_id = row.find("td").eq(0).attr("ProfesionId");
                    implicado.Rango_id = row.find("td").eq(1).attr("RangoId");
                    implicado.Nombres = row.find("td").eq(2).text();
                    implicado.Apellidos = row.find("td").eq(3).text();
                    implicado.Sexo = row.find("td").eq(4).text();
                    implicado.Nacionalidad = row.find("td").eq(5).attr("NacionalidadId");
                    implicado.Edad = row.find("td").eq(6).text();
                    implicado.Condicion_implicado_id = row.find("td").eq(7).attr("CondicionId");
                    implicados.push(implicado);

                    //implicados.push({ profesion: $(this).find('td:eq(0)').text(), rango_militar: $(this).find('td:eq(1)').text(), nombre: $(this).find('td:eq(2)').text(), apellido: $(this).find('td:eq(3)').text(), sexo: $(this).find('td:eq(4)').text(), nacionalidad: $(this).find('td:eq(5)').text(), edad: $(this).find('td:eq(6)').text(), condicion: $(this).find('td:eq(7)').text() })

                })


                implicados = JSON.stringify({ implicados: implicados });
                Evento = JSON.stringify({ Evento: Evento });
                $.ajax({
                    dataType: "application/json",
                    url: "/REGISTRO_EVENTO/Create",
                    type: "POST",
                    data: Evento,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                       
                        if (data == 1) {
                        var link = "@Url.Action("Index", "REGISTRO_EVENTO", null)";
                            window.location.href = link;
                            $.ajax({
                                dataType: "application/json",
                                url: "/REGISTRO_EVENTO/CreateVinculados",
                                type: "POST",
                                data: implicados,
                                
                                contentType: "application/json; charset=utf-8",
                                success: function (r) {
                                    alert("Se agregaron " + r + " registros correctamente");
                                    console.log(implicados);
                                },
                                error: function (xhr, textStatus, errorThrown) {
                                    alert('No se completo');
                                },
                                complete: function () {



                                }
                            });
                        };
                        //var evento_id = data;
                        //console.log(evento_id)
                        
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        alert('Error!!');
                    },
                    complete: function () {

                       
                       
                         
                    }
                });
            });
        });


        //$('#btn_crear').click(function () {


        //    var implicados = new Array();

        //    $('#t_tbody tr').each(function () {

        //        var row = $(this);
        //        var implicado = {};
        //        implicado.Profesion_id = row.find("td").eq(0).text();
        //        implicado.Rango_id = row.find("td").eq(1).text();
        //        implicado.Nombres = row.find("td").eq(2).text();
        //        implicado.Apellidos = row.find("td").eq(3).text();
        //        implicado.Sexo = row.find("td").eq(4).text();
        //        implicado.Nacionalidad = row.find("td").eq(5).text();
        //        implicado.Edad = row.find("td").eq(6).text();
        //        implicado.Condicion_implicado_id = row.find("td").eq(7).text();
        //        implicados.push(implicado);

        //        //implicados.push({ profesion: $(this).find('td:eq(0)').text(), rango_militar: $(this).find('td:eq(1)').text(), nombre: $(this).find('td:eq(2)').text(), apellido: $(this).find('td:eq(3)').text(), sexo: $(this).find('td:eq(4)').text(), nacionalidad: $(this).find('td:eq(5)').text(), edad: $(this).find('td:eq(6)').text(), condicion: $(this).find('td:eq(7)').text() })

        //    })

        //    console.log(implicados);
        //    implicados = JSON.stringify({ implicados: implicados });
        //    $.ajax({
        //        dataType: "application/json",
        //        url: "/REGISTRO_EVENTO/CreateVinculados",
        //        type: "POST",
        //        data: implicados,
        //        dataType: "json",
        //        contentType: "application/json; charset=utf-8",
        //        success: function (r) {
        //            alert("Se agregaron"+ r +"registros correctamente");
        //            console.log(implicados);
        //        },
        //        error: function (xhr, textStatus, errorThrown) {
        //            alert('Error!!');
        //        }
        //    });

        //})

        $('#direccion1').keyup((e) => {
            if (e.keyCode == 13) {
                //codeLatLon();
                codeAddress();

            }
        });
        $(function () {
            $.getJSON("/Registro_Evento/GetRegionales", null, function (data) {
                $("#RegionalId").fillSelect(data);
            });
        });
        $(function () {
            $.getJSON("/Registro_Evento/GetComandancia", null, function (data) {
                $("#ComandanciaId").fillSelect(data);
            });
        });
        $(function () {
            $.getJSON("/Registro_Evento/GetZona", null, function (data) {
                $("#ZonaId").fillSelect(data);
            });
        });
        $(function () {
            $.getJSON("/Registro_Evento/GetMunicipios", null, function (data) {
                $("#MunicipioId").fillSelect(data);
            });
        });
        $(function () {
            $.getJSON("/Registro_Evento/GetTipoInvolucrado", null, function (data) {
                $("#Tipo_InvolucradoId").fillSelect(data);
            });
        });
        $(function () {
            $.getJSON("/Registro_Evento/GetCondicion", null, function (data) {
                $("#CondicionId").fillSelect(data);
            });
        });
        $(function () {
            $.getJSON("/Registro_Evento/GetRango", null, function (data) {
                $("#txt_rango").fillSelect(data);
            });
        });
        $(function () {
            $.getJSON("/Registro_Evento/GetNacionalidad", null, function (data) {
                $("#txt_nacionalidad").fillSelect(data);
            });
        });

        $(function () {
            $.getJSON("/Registro_Evento/GetProfesion", null, function (data) {
                $("#txt_profesion").fillSelect(data);
            });


            //$('#txt_profesion').selectstyle();

            //$('.demo').dropdown({
            //    // options here
            //});

        });


        $('#btn_agregar_lista').click(function () {

            var success = "1"

            if ($('#txt_profesion').val() == "9999") {
                console.log('1')
                success = "0";
                swal("Faltan parametros!", "Debe llenar los espacios en blanco", "warning")
            }
            if ($('#txt_rango').val() == "9999") {
                console.log('2')
                success = "0";
                swal("Faltan parametros!", "Debe llenar los espacios en blanco", "warning")
            }
            if ($('#txt_nombre').val() == "") {
                console.log('3')
                success = "0";
                swal("Faltan parametros!", "Debe llenar los espacios en blanco", "warning")
            }
            if ($('#txt_apellido').val() == "") {
                console.log('4')
                success = "0";
                swal("Faltan parametros!", "Debe llenar los espacios en blanco", "warning")
            }
            if ($('#txt_sexo').val() == "") {
                console.log('5')
                success = "0";
                swal("Faltan parametros!", "Debe llenar los espacios en blanco", "warning")
            }
            if ($('#txt_nacionalidad').val() == "9999") {
                console.log('6')
                success = "0";
                swal("Faltan parametros!", "Debe llenar los espacios en blanco", "warning")
            }
            if ($('#txt_edad').val() == "") {
                console.log('7')
                success = "0";
                swal("Faltan parametros!", "Debe llenar los espacios en blanco", "warning")
            }
            if ($('#CondicionId').val() == "9999") {
                console.log('8')
                success = "0";
                swal("Faltan parametros!", "Debe llenar los espacios en blanco", "warning")
            }

            let profesionId_ = $('#txt_profesion').val()
            let profesionText_ = $("#txt_profesion option:selected").text()
            let rangoId_ = $('#txt_rango').val()
            let rangoText_ = $("#txt_rango option:selected").text()
            let nacionalidadId_ = $('#txt_nacionalidad').val()
            let nacionalidadText_ = $("#txt_nacionalidad option:selected").text()
            let condicionId_ = $('#CondicionId').val()
            let condicionText_ = $("#CondicionId option:selected").text()

            if (success == "1") {
                $('#t_tbody').append(`<tr><td ProfesionId = ${profesionId_} >${profesionText_}</td>
                    <td RangoId = ${rangoId_} >${rangoText_}</td>
                    <td>${$('#txt_nombre').val()}</td>
                    <td>${$('#txt_apellido').val()}</td>
                    <td>${$('#txt_sexo').val()}</td>
                    <td NacionalidadId = ${nacionalidadId_} >${nacionalidadText_}</td>
                    <td>${$('#txt_edad').val()}</td>
                    <td CondicionId = ${condicionId_}>${condicionText_}</td>
                    <td><a class="remove-row">Eliminar</a></td></tr>`);
                $('.remove-row').click(function () {
                    row = $(this).closest('tr');
                    row.remove();
                })

                
                $('#txt_nombre').val("");
                $('#txt_apellido').val("");
                $('#txt_sexo').val("");
                $('#txt_edad').val("");
              
                $('#modal_implicados').modal('hide');
              
            }

        })
        

    </script>



    <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyBYqf2hpqWVtfx3Co2EZlkrY9OFrMnc0PM'></script>

    <script language=javascript type=text/javascript>
        // Script para que la tecla ENTER no funcione
        function stopRKey(evt) {
            var evt = (evt) ? evt : ((event) ? event : null);
            var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null);
            if ((evt.keyCode == 13) && (node.type == "text")) { return false; }
        }

        document.onkeypress = stopRKey;
        function trueorfalse() {


        }

    </script>


    <script type="text/javascript">
        // VARIABLES GLOBALES JAVASCRIPT
        var geocoder;
        var marker;
        var latLng;
        var latLng2;
        var map;

        // INICiALIZACION DE MAPA
        function initialize() {
            var lat = 18.87510275035649;
            var lng = -71.12548828125;
            var latitud = 0;
            var longitud = 0;

            //	if (navigator.geolocation) {
            //		navigator.geolocation.getCurrentPosition(coordenadas);
            //          var latitud = position.coords.latitude;
            //          var longitud = position.coords.longitude;
            //	}

            geocoder = new google.maps.Geocoder();
            latLng = new google.maps.LatLng(lat, lng);
            map = new google.maps.Map(document.getElementById('mapCanvas'), {
                zoom: 8,
                center: latLng,
                //   mapTypeId: google.maps.MapTypeId.HYBRID  });
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });

            // CREACION DEL MARCADOR
            marker = new google.maps.Marker({
                position: latLng,
                title: 'Arrastra el marcador si quieres moverlo',
                map: map,
                draggable: false
            });



            // Escucho el CLICK sobre el mama y si se produce actualizo la posicion del marcador
            google.maps.event.addListener(map, 'click', function (event) {
                updateMarker(event.latLng);
            });
            // Inicializo los datos del marcador
            //    updateMarkerPosition(latLng);
            geocodePosition(latLng);
            // Permito los eventos drag/drop sobre el marcador
            google.maps.event.addListener(marker, 'dragstart', function () {
                updateMarkerAddress('Arrastrando...');
            });



            google.maps.event.addListener(marker, 'drag', function () {
                updateMarkerStatus('Arrastrando...');
                updateMarkerPosition(marker.getPosition());

            });



            google.maps.event.addListener(marker, 'dragend', function () {

                updateMarkerStatus('Arrastre finalizado');

                geocodePosition(marker.getPosition());

            });







        }





        // Permito la gesti¢n de los eventos DOM

        google.maps.event.addDomListener(window, 'load', initialize);



        // ESTA FUNCION OBTIENE LA DIRECCION A PARTIR DE LAS COORDENADAS POS

        function geocodePosition(pos) {

            geocoder.geocode({

                latLng: pos

            }, function (responses) {

                if (responses && responses.length > 0) {
                    //console.log(responses);
                    updateMarkerAddress(responses[0].formatted_address)

                } else {

                    updateMarkerAddress('No se puedo encontrar esta direccion.');

                }

            });

        }



        // OBTIENE LA DIRECCION A PARTIR DEL LAT y LON DEL FORMULARIO

        function codeLatLon() {

            var str = $('#txtlongitud').val() + " , " + $('#txtlatitud').val();

            var latLng2 = new google.maps.LatLng($('#txtlatitud').val(), $('#txtlongitud').val());

            marker.setPosition(latLng2);

            map.setCenter(latLng2);

            geocodePosition(latLng2);

            map.zoom = '14';

            // document.form1.direccion.value = str+" OK";

        }



        // OBTIENE LAS COORDENADAS DESDE lA DIRECCION EN LA CAJA DEL FORMULARIO

        function codeAddress() {

            var address = $('#direccion1').val();

            geocoder.geocode({ 'address': address }, function (results, status) {

                if (status == google.maps.GeocoderStatus.OK) {

                    updateMarkerPosition(results[0].geometry.location);

                    marker.setPosition(results[0].geometry.location);

                    map.setCenter(results[0].geometry.location);

                    map.zoom = '14';

                } else {

                    alert('ERROR : ' + status);

                }

            });

        }



        // OBTIENE LAS COORDENADAS DESDE lA DIRECCION EN LA CAJA DEL FORMULARIO

        function codeAddress2(address) {



            geocoder.geocode({ 'address': address }, function (results, status) {

                if (status == google.maps.GeocoderStatus.OK) {

                    updateMarkerPosition(results[0].geometry.location);

                    marker.setPosition(results[0].geometry.location);

                    map.setCenter(results[0].geometry.location);

                    document.form1.direccion1.value = address;

                } else {

                    alert('ERROR : ' + status);

                }

            });

        }



        function updateMarkerStatus(str) {

            $('#direccion1').val(str);

        }



        // RECUPERO LOS DATOS LON LAT Y DIRECCION Y LOS PONGO EN EL FORMULARIO

        function updateMarkerPosition(latLng) {

            $('#txtlongitud').val(latLng.lng);
            $('#txtlatitud').val(latLng.lat());

        }



        function updateMarkerAddress(str) {
            $('#direccion1').val(str);
        }



        // ACTUALIZO LA POSICION DEL MARCADOR

        function updateMarker(location) {

            marker.setPosition(location);

            updateMarkerPosition(location);

            geocodePosition(location);

        }

        function coordenadas() {
            var latitud = position.coords.latitude;
            var longitud = position.coords.longitude;
        }

    </script>


}
